---
- include: deployer-user.yml
  when: deploy_user != 'root'
  tags: server-provision

- include: deploy-dependencies.yml
  tags: server-provision

- include: code-deploy.yml
  tags: code-deploy

# TODO: Automate initial config
# - name: Create admin user
#   shell: "./bin/ushahidi user create --email \"{{ EMAIL }}\" --role admin --password \"{{ PASSWORD }}\" --realname \"{{ DISPLAY_NAME }}\""
#   register: admin_user
#   when: EMAIL is defined and EMAIL != None and EMAIL != ""
#   args:
#     chdir: "{{ base_path }}"

# - name: Delete default admin user
#   shell: "./bin/ushahidi user delete --email \"admin\""
#   when: EMAIL is defined and EMAIL != None and EMAIL != ""
#   args:
#     chdir: "{{ base_path }}"

# - name: Set site name
#   shell: "./bin/ushahidi config:set site --key name \"{{ DEPLOYMENT_NAME }}\" "
#   when: DEPLOYMENT_NAME is defined and DEPLOYMENT_NAME != None and DEPLOYMENT_NAME != ""
#   args:
#     chdir: "{{ base_path }}"
